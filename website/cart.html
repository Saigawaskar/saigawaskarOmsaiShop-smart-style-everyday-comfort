<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Cart ¬∑ OmsaiShop</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header class="navbar">
    <div class="nav-left"><a class="brand" href="index.html"><span class="logo-dot">üõçÔ∏è</span> OmsaiShop</a></div>
    <div class="nav-right">
      <a href="index.html" class="btn">Home</a>
      <button id="themeToggle" class="btn" aria-label="Toggle dark mode">üåô</button>
    </div>
  </header>
  <main class="container">
    <h1>Your Cart</h1>
    <div id="cartItems" class="cart-items" style="border:1px solid var(--border); border-radius:12px; padding:0.75rem;"></div>
    <div class="cart-footer" style="margin-top:1rem;">
      <div class="total">Total: ‚Çπ<span id="cartTotal">0</span></div>
    </div>

    <section class="checkout-section" id="checkout">
      <h2>Checkout</h2>
      <form id="checkoutForm" novalidate>
        <div class="form-row">
          <label>Payment Method</label>
          <div style="display:flex;gap:.75rem;flex-wrap:wrap">
            <label><input type="radio" name="pay" value="card" checked /> Card</label>
            <label><input type="radio" name="pay" value="cod" /> Cash on Delivery</label>
            <label><input type="radio" name="pay" value="upi" /> UPI</label>
          </div>
        </div>
        <div class="form-row">
          <label for="name">Full Name</label>
          <input id="name" name="name" type="text" required placeholder="John Doe" />
          <span class="error" data-for="name"></span>
        </div>
        <div class="form-row">
          <label for="email">Email</label>
          <input id="email" name="email" type="email" required placeholder="john@example.com" />
          <span class="error" data-for="email"></span>
        </div>
        <div class="form-row">
          <label for="address">Address</label>
          <input id="address" name="address" type="text" required placeholder="123 Main St" />
          <span class="error" data-for="address"></span>
        </div>
        <div class="form-row two card-fields">
          <div>
            <label for="card">Card Number</label>
            <input id="card" name="card" type="text" inputmode="numeric" maxlength="19" required placeholder="4242 4242 4242 4242" />
            <span class="error" data-for="card"></span>
          </div>
          <div>
            <label for="cvv">CVV</label>
            <input id="cvv" name="cvv" type="text" inputmode="numeric" maxlength="4" required placeholder="123" />
            <span class="error" data-for="cvv"></span>
          </div>
        </div>
        <div class="form-row upi-field" style="display:none">
          <label for="upi">UPI ID</label>
          <input id="upi" name="upi" type="text" placeholder="yourname@upi" />
          <span class="error" data-for="upi"></span>
        </div>
        <button type="submit" class="btn primary">Place Order</button>
      </form>
    </section>
  </main>
  <footer class="footer"><p>¬© <span id="year"></span> OmsaiShop ¬∑ Made by Sai Sunil Gawaskar</p></footer>

  <script type="module">
    import { Cart } from './js/cart.js';
    import { initTheme } from './js/theme.js';
    import { initCheckout } from './js/checkout.js';
    const yearEl = document.getElementById('year');
    yearEl.textContent = new Date().getFullYear();
    initTheme();

    const cart = new Cart();
    const cartItemsEl = document.getElementById('cartItems');
    const cartTotalEl = document.getElementById('cartTotal');

    function renderCart() {
      const items = cart.getItems();
      cartItemsEl.innerHTML = '';
      if (items.length === 0) { cartItemsEl.innerHTML = '<p>Your cart is empty.</p>'; }
      items.forEach(item => {
        const row = document.createElement('div');
        row.className = 'cart-item';
        row.innerHTML = `
          <img src="${item.image}" alt="${item.name}" />
          <div class=\"meta\">
            <div>${item.name}</div>
            <div class=\"price\">‚Çπ${item.price}</div>
            <div class=\"qty\">
              <button data-action=\"dec\" data-id=\"${item.id}\" class=\"btn\">-</button>
              <span>${item.quantity}</span>
              <button data-action=\"inc\" data-id=\"${item.id}\" class=\"btn\">+</button>
              <button data-action=\"remove\" data-id=\"${item.id}\" class=\"btn\">Remove</button>
            </div>
          </div>`;
        cartItemsEl.appendChild(row);
      });
      cartTotalEl.textContent = cart.getTotal().toFixed(2);
    }

    cartItemsEl.addEventListener('click', (e) => {
      const t = e.target;
      if (!(t instanceof HTMLElement)) return;
      const id = t.getAttribute('data-id');
      const action = t.getAttribute('data-action');
      if (!id || !action) return;
      if (action === 'inc') cart.increment(id);
      if (action === 'dec') cart.decrement(id);
      if (action === 'remove') cart.remove(id);
      renderCart();
    });

    renderCart();

    // Checkout -> save order and redirect
    initCheckout(() => {
      const order = { id: 'ORD-' + Math.random().toString(36).slice(2,8).toUpperCase(), items: cart.getItems(), total: cart.getTotal(), ts: Date.now() };
      localStorage.setItem('shoplite_last_order', JSON.stringify(order));
      cart.clear();
      window.location.href = 'order.html';
    });

    // toggle card vs upi vs cod fields
    const payRadios = document.querySelectorAll('input[name="pay"]');
    const cardFields = document.querySelector('.card-fields');
    const upiField = document.querySelector('.upi-field');
    payRadios.forEach(r => r.addEventListener('change', () => {
      const val = document.querySelector('input[name="pay"]:checked').value;
      cardFields.style.display = val === 'card' ? 'grid' : 'none';
      upiField.style.display = val === 'upi' ? 'grid' : 'none';
    }));
  </script>
</body>
</html>


